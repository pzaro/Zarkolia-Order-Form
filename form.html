<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Φόρμα Παραγγελίας Προϊόντων</title>
    
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            line-height: 1.6; 
            margin: 0; 
            padding: 20px;
            background-color: #f4f7f6; 
        }
        .container {
            max-width: 1100px; 
            margin: 20px auto; 
            background-color: #ffffff; 
            padding: 30px 40px; 
            border-radius: 12px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }
        h1, h2, h3 { color: #2c3e50; }
        h1 { font-size: 2.2em; margin-bottom: 25px; text-align: center; }
        h2 { font-size: 1.6em; border-bottom: 2px solid #4CAF50; padding-bottom: 8px; margin-top: 40px; }
        
        /* --- Βελτιωμένο Στυλ για τη Φόρμα --- */
        .form-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 22px; 
        }
        .form-group label { 
            display: block; 
            margin-bottom: 7px; 
            font-weight: 600; 
            color: #555; 
            font-size: 0.9em;
        }
        .form-group input { 
            width: 100%;
            padding: 12px; 
            border: 1px solid #dce1e6; 
            border-radius: 6px; 
            box-sizing: border-box; 
            font-size: 1em;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .form-group input:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.15);
            outline: none;
        }

        .product-gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .product-card { border: 1px solid #e0e6ed; border-radius: 8px; text-align: center; padding: 15px; cursor: pointer; transition: all 0.3s ease; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .product-card img { max-width: 100%; height: 120px; object-fit: contain; margin-bottom: 10px; }
        .product-card h4 { margin: 0; font-size: 0.9em; color: #34495e; height: 40px; }
        
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 30px; border-radius: 10px; width: 90%; max-width: 700px; }
        .modal-header { display: flex; justify-content: space-between; border-bottom: 1px solid #ddd; padding-bottom: 15px; }
        .modal-header h2 { margin: 0; color: #4CAF50; }
        .modal-header .close-button { font-size: 2.5em; font-weight: bold; color: #aaa; cursor: pointer; line-height: 1; }
        .modal-body { padding: 20px 0; max-height: 60vh; overflow-y: auto; }
        .modal-body img { float: left; margin-right: 20px; max-width: 150px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 25px; }
        th, td { border: 1px solid #e0e6ed; padding: 12px; text-align: left; vertical-align: middle; }
        th { background-color: #4CAF50; color: white; }
        #product-table tbody tr:nth-child(even) { background-color: #fbfcfd; }
        
        /* --- Στυλ για την Τελική Τιμή --- */
        .effective-price { font-weight: bold; transition: color 0.3s; }
        .effective-price.discounted { color: #28a745; /* Πράσινο χρώμα για την έκπτωση */ }
        .effective-price.normal { color: #333; /* Κανονικό χρώμα */ }
        
        .totals-section { margin-top: 30px; padding: 25px; text-align: right; background-color: #f8f8f8; border-radius: 8px; }
        .bank-info { margin-top: 20px; padding: 20px; border: 2px dashed #4CAF50; border-radius: 8px; background-color: #f0fff0; }
        .bank-info h3 { margin-top: 0; color: #2c3e50; }
        .export-buttons { margin-top: 40px; display: flex; justify-content: center; gap: 15px; }
        .btn { padding: 14px 28px; border: none; border-radius: 8px; cursor: pointer; font-size: 1.05em; font-weight: 600; color: white; }

        /* --- ΝΕΟ Στυλ για την Κλίμακα Δώρων & τις Οδηγίες --- */
        .info-section {
            max-width: 1100px; margin: 40px auto; padding: 25px;
            border-left: 5px solid; border-radius: 8px;
        }
        .gift-scale {
            background-color: #eaf5ff; border-color: #007bff; color: #004085;
        }
        .instructions {
            background-color: #f0fff0; border-color: #2e8b57; color: #2e8b57;
        }
        .info-section h3 { margin-top: 0; }
        .info-section ul { padding-left: 20px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Κατάλογος & Φόρμα Παραγγελίας</h1>
        <div id="productGallery" class="product-gallery"></div>
        <form id="orderForm" onsubmit="return false;">
            <h2>Στοιχεία Πελάτη</h2>
            <div class="form-grid">
                <div class="form-group"><label for="eponimia">Επωνυμία:</label><input type="text" id="eponimia" required></div>
                <div class="form-group"><label for="afm">ΑΦΜ:</label><input type="text" id="afm"></div>
                <div class="form-group"><label for="doy">ΔΟΥ:</label><input type="text" id="doy"></div>
                <div class="form-group"><label for="mobile">Κινητό:</label><input type="tel" id="mobile"></div>
                <div class="form-group"><label for="phone">Σταθερό:</label><input type="tel" id="phone"></div>
                <div class="form-group"><label for="email">Email:</label><input type="email" id="email"></div>
            </div>
            <table id="product-table">
                <thead>
                    <tr><th>Ονομασία</th><th>Αρχική Τιμή</th><th>Ποσότητα</th><th>Δώρα</th><th>Τελική Τιμή/Τεμ.</th><th>Σύνολο</th></tr>
                </thead>
                <tbody></tbody>
            </table>
            <div class="totals-section">
                <p>Καθαρή Αξία: <span id="net-value">0.00 €</span></p>
                <p>Αξία ΦΠΑ (24%): <span id="vat-value">0.00 €</span></p>
                <p><strong>Τελικό Ποσό:</strong> <span id="final-total">0.00 €</span></p>
            </div>
            <div class="bank-info">
                <h3>Στοιχεία Κατάθεσης</h3>
                <p><strong>IBAN:</strong> GR8901722520005252016160277</p>
                <p><strong>Τράπεζα:</strong> Τράπεζα Πειραιώς</p>
            </div>
            <div class="export-buttons">
                <button type="button" class="btn" style="background-color:#007bff" onclick="sendEmailViaClient()">Αποστολή με Email</button>
                <button type="button" class="btn" style="background-color:#34495e" onclick="previewAndSaveAsTXT()">Αποθήκευση σε TXT</button>
                <button type="button" class="btn" style="background-color:#f0ad4e" onclick="clearForm()">Καθαρισμός Φόρμας</button>
            </div>
        </form>
    </div>

    <div class="info-section gift-scale">
        <h3>Κλίμακα Δώρων</h3>
        <ul>
            <li>Για <b>9</b> τεμάχια, παίρνετε <b>+1</b> δώρο.</li>
            <li>Για <b>18</b> τεμάχια, παίρνετε <b>+3</b> δώρα.</li>
            <li>Για <b>24</b> τεμάχια, παίρνετε <b>+6</b> δώρα.</li>
            <li>Για <b>48</b> τεμάχια και άνω, η προσφορά συνεχίζεται <b>αναλογικά</b> (π.χ. για 96 τεμάχια, παίρνετε 30 δώρα).</li>
        </ul>
    </div>

    <div class="info-section instructions">
        <h3>Οδηγίες Χρήσης</h3>
        <p>1. Πατήστε σε μια εικόνα προϊόντος για να δείτε την περιγραφή του.<br>2. Συμπληρώστε τις ποσότητες που επιθυμείτε στον πίνακα. Οι υπολογισμοί γίνονται αυτόματα.<br>3. Ολοκληρώστε την παραγγελία με αποστολή Email ή αποθηκεύοντάς την ως αρχείο TXT.</p>
    </div>

    <div id="productModal" class="modal"></div>
    <div id="previewModal" class="modal"></div>
    
    <script>
        // Data and functions... (same as before)
        const products=[{name:'Z-DermAspis',price:5.03},{name:'ZplastCream 40gr',price:12.3},{name:'ZplastCream 100gr',price:24.79},{name:'Bruise Off Bite Out & Pain Free cream',price:5.26},{name:'Z-boost 30 caps',price:14.93},{name:'Z-boost 12 caps',price:6.99},{name:'Zarkolia Cosmetic pack',price:23.89},{name:'Hydralia Face cream 50ml',price:8.9},{name:'Revitacell + Face cream 50ml',price:10.69},{name:'Revitace Eyes cream Luce 30ml',price:10.1},{name:'Alveolair Sir',price:7.65}];
        const productDetails=[{id:'alveolair',name:'Alveol Air Φυτικό Σιρόπι',image:'URL_ΕΙΚΟΝΑΣ_ΣΙΡΟΠΙΟΥ_ΕΔΩ',description:`<h3>Φυτικό Σιρόπι...</h3>`},{id:'revitacell_plus',name:'Revitacell Plus',image:'URL_ΕΙΚΟΝΑΣ_REVITACELL_PLUS_ΕΔΩ',description:`<h3>Αντιρυτιδική Κρέμα...</h3>`},{id:'revitacell_eyes',name:'Revitacell Eyes Luce',image:'URL_ΕΙΚΟΝΑΣ_EYES_LUCE_ΕΔΩ',description:`<h3>Κρέμα Ματιών...</h3>`},{id:'hydralia',name:'Hydralia Face Cream',image:'URL_ΕΙΚΟΝΑΣ_HYDRALIA_ΕΔΩ',description:`<h3>Ενυδατική Κρέμα...</h3>`},{id:'zplast',name:'Zplast Cream',image:'URL_ΕΙΚΟΝΑΣ_ZPLAST_ΕΔΩ',description:`<h3>Αναπλαστική Κρέμα...</h3>`},{id:'boost_caps',name:'Z-Boost Caps',image:'URL_ΕΙΚΟΝΑΣ_BOOST_CAPS_ΕΔΩ',description:`<h3>Συμπλήρωμα Διατροφής...</h3>`},{id:'cosmetic_pack',name:'Zarkolia Cosmetic Pack',image:'URL_ΕΙΚΟΝΑΣ_PACK_ΕΔΩ',description:`<h3>Πακέτο Περιποίησης...`}];
        
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById('productModal').innerHTML = `<div class="modal-content"><div class="modal-header"><h2 id="modalProductName"></h2><span class="close-button" onclick="closeProductModal()">&times;</span></div><div class="modal-body"><img id="modalProductImage" src="" alt="Product Image"><div id="modalProductDescription"></div></div></div>`;
            document.getElementById('previewModal').innerHTML = `<div class="modal-content"><div class="modal-header"><h2>Προεπισκόπηση</h2><span class="close-button" onclick="closePreviewModal()">&times;</span></div><div class="modal-body"><pre id="previewContent"></pre></div><div class="modal-footer"><button id="saveTxtButton" class="btn" style="background-color:#5cb85c">Αποθήκευση</button><button class="btn" style="background-color:#aaa" onclick="closePreviewModal()">Κλείσιμο</button></div></div>`;
            const gallery=document.getElementById('productGallery');productDetails.forEach(p=>{const c=document.createElement('div');c.className='product-card';c.onclick=()=>showProductDetails(p.id);c.innerHTML=`<img src="${p.image}" alt="${p.name}"><h4>${p.name}</h4>`;gallery.appendChild(c);});
            const tableBody=document.querySelector('#product-table tbody');products.forEach(p=>{const r=document.createElement('tr');r.innerHTML=`<td>${p.name}</td><td>${p.price.toFixed(2)} €</td><td><input type="number" class="quantity" min="0" data-price="${p.price}" oninput="updateAll()" value="0"></td><td class="gifts">0</td><td class="effective-price normal">${p.price.toFixed(2)} €</td><td class="line-total">0.00 €</td>`;tableBody.appendChild(r);});
            updateAll();
        });

        function showProductDetails(id){const p=productDetails.find(p=>p.id===id);if(p){document.getElementById('modalProductName').textContent=p.name;document.getElementById('modalProductImage').src=p.image;document.getElementById('modalProductDescription').innerHTML=p.description;document.getElementById('productModal').style.display='block';}}
        function closeProductModal(){document.getElementById('productModal').style.display='none';}
        function closePreviewModal(){document.getElementById('previewModal').style.display='none';}

        function calculateGifts(quantity){if(quantity<9)return 0;if(quantity>=9&&quantity<18)return 1;if(quantity>=18&&quantity<24)return 3;if(quantity>=24&&quantity<48)return 6;const ratio=15/48;return Math.floor(quantity*ratio);}
        
        function updateAll(){
            let netTotal=0;
            document.querySelectorAll("#product-table tbody tr").forEach(row => {
                const quantityInput = row.querySelector(".quantity");
                const quantity = parseInt(quantityInput.value) || 0;
                const price = parseFloat(quantityInput.dataset.price);
                
                const gifts = calculateGifts(quantity);
                const totalItems = quantity + gifts;
                const lineTotal = quantity * price;
                
                let effectivePrice = price;
                if (quantity > 0 && totalItems > 0) {
                    effectivePrice = lineTotal / totalItems;
                }
                
                const priceCell = row.querySelector(".effective-price");
                priceCell.innerHTML = `${effectivePrice.toFixed(2)} €`; // <-- ΔΙΟΡΘΩΣΗ: 2 δεκαδικά
                
                // --- ΔΙΟΡΘΩΣΗ: Αλλαγή χρώματος ---
                if (effectivePrice < price) {
                    priceCell.classList.add('discounted');
                    priceCell.classList.remove('normal');
                } else {
                    priceCell.classList.add('normal');
                    priceCell.classList.remove('discounted');
                }
                
                row.querySelector(".gifts").textContent = gifts;
                row.querySelector(".line-total").innerHTML = `${lineTotal.toFixed(2)} €`;
                netTotal += lineTotal;
            });

            const vat = netTotal * 0.24;
            const finalTotal = netTotal + vat;

            document.getElementById("net-value").innerHTML = `${netTotal.toFixed(2)} €`;
            document.getElementById("vat-value").innerHTML = `${vat.toFixed(2)} €`;
            document.getElementById("final-total").innerHTML = `${finalTotal.toFixed(2)} €`;
        }
        
        // --- Οι υπόλοιπες συναρτήσεις (getOrderData, generateOrderContent, κλπ.) παραμένουν ίδιες ---
        function getOrderData(){const c={eponimia:document.getElementById("eponimia").value,afm:document.getElementById("afm").value,doy:document.getElementById("doy").value,mobile:document.getElementById("mobile").value,phone:document.getElementById("phone").value,email:document.getElementById("email").value};const i=[];document.querySelectorAll("#product-table tbody tr").forEach(r=>{const q=parseInt(r.querySelector('.quantity').value)||0;q>0&&i.push({name:r.cells[0].textContent,quantity:q,gifts:parseInt(r.querySelector('.gifts').textContent),effectivePrice:r.querySelector('.effective-price').textContent,total:r.querySelector('.line-total').textContent});});return{customerData:c,items:i,totals:{net:document.getElementById("net-value").textContent,vat:document.getElementById("vat-value").textContent,final:document.getElementById("final-total").textContent}}}
        function generateOrderContent(){const{customerData:c,items:i,totals:t}=getOrderData();const b="\n\nΣΤΟΙΧΕΙΑ ΚΑΤΑΘΕΣΗΣ\n----------------------------------------\nIBAN: GR8901722520005252016160277\nΤράπεζα: Τράπεζα Πειραιώς\n";let content="========================================\n      Π Α Ρ Α Γ Γ Ε Λ Ι Α\n========================================\n\n";content+="ΣΤΟΙΧΕΙΑ ΠΕΛΑΤΗ\n----------------------------------------\n";content+=`Επωνυμία: ${c.eponimia}\nΑΦΜ: ${c.afm}\nΔΟΥ: ${c.doy}\n`;content+=`Email: ${c.email}\nΤηλ: ${c.mobile} / ${c.phone}\n\n`;content+="ΑΝΑΛΥΣΗ ΠΑΡΑΓΓΕΛΙΑΣ\n------------------------------------------------------------------------\n";i.forEach(item=>{let qText=item.gifts>0?`${item.quantity} (+${item.gifts} Δώρο)`:`${item.quantity}`;content+=`${item.name}\n`;content+=`  └─ Ποσότητα: ${qText.padEnd(15)} | Τελ. Τιμή/Τεμ.: ${item.effectivePrice.padEnd(12)} | Σύνολο: ${item.total.padStart(8)}\n\n`;});content+="------------------------------------------------------------------------\n\n";content+="ΣΥΝΟΛΑ\n----------------------------------------\n";content+=`Καθαρή Αξία:${''.padStart(15)} ${t.net}\n`;content+=`Αξία ΦΠΑ (24%):${''.padStart(11)} ${t.vat}\n`;content+=`ΤΕΛΙΚΟ ΠΟΣΟ:${''.padStart(14)} ${t.final}\n`;content+=b;return content;}
        function sendEmailViaClient(){const{customerData:c,items:i}=getOrderData();if(i.length===0){alert("Η παραγγελία είναι κενή.");return}const body=generateOrderContent();const subject=`Νέα Παραγγελία από ${c.eponimia||'Νέος Πελάτης'}`;let mailtoLink=`mailto:pzaro2010@gmail.com,liapaki2017@gmail.com`;c.email&&(mailtoLink+=`?cc=${c.email}`);mailtoLink+=`&subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;window.location.href=mailtoLink;}
        function previewAndSaveAsTXT(){if(getOrderData().items.length===0){alert("Η παραγγελία είναι κενή.");return}const content=generateOrderContent();const filename=`Παραγγελία_${getOrderData().customerData.eponimia.replace(/\s/g,'_')||'customer'}.txt`;document.getElementById('previewContent').textContent=content;document.getElementById('previewModal').style.display='block';document.getElementById('saveTxtButton').onclick=()=>saveTextAsFile(content,filename);}
        function saveTextAsFile(text,filename){const blob=new Blob([text],{type:'text/plain;charset=utf-8'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download=filename;document.body.appendChild(link);link.click();document.body.removeChild(link);closePreviewModal();}
        function clearForm(){document.getElementById("orderForm").reset();document.querySelectorAll(".quantity").forEach(q=>{q.value="0"});updateAll();}
    </script>
</body>
</html>
